Electro Girl プロジェクト 引き継ぎメモ（Savepoint）
■ 現在のセーブポイント概要

常駐アプリとしての人格ループが安定動作している状態。
「歩く・止まる・黙る・話す・介入に反応する」が自然に循環し、
UI／描画／ロジックの責務分離も成立。

Gitタグ例：

savepoint-idle-walk-talk-stable

■ 技術スタック

OS：Windows

Python：3.14

pygame-ce：2.5.x

venv 使用

WinAPI（最前面化）使用あり

■ ディレクトリ構成（主要）
electro_girl/
 ├ main.py                # ゲームループ／行動スケジューラ
 ├ game/
 │   ├ model.py           # Girl状態（保存対象）
 │   ├ sim.py             # 移動・育成・行動ロジック
 │   ├ render.py          # 描画（レイヤー管理含む）
 │   ├ dialogue.py        # 会話処理（表示時間制御）
 │   ├ snacks.py          # おやつデータ管理
 │   ├ ui.py              # UI（共通ルール化済）
 │   ├ config.py          # 各種パラメータ
 │   └ assets.py          # アセットロード
 └ assets/
    ├ sprite/
    ├ snacks/
    ├ dialogue/
    └ sfx/

■ 現在“確実に動いている”機能
● 行動ループ（最重要）

会話 → 無言 → 次の行動を選択 というビート制

会話終了時：

口パク終了

表示文字を即クリア

無言時間を挟んで「次の行動」を決定

次の行動候補（現状）：

会話

歩行
※ 将来ここに行動を追加可能な設計

● X軸移動

右側パネル内を左右に気まぐれ移動

壁で反転

立ち止まり時間の方が長い（常駐向け）

HUDで vx / x_offset を観測可能

描画側で cx += g.x_offset を必ず反映（重要）

● 会話ルール

歩行中・睡眠中は 会話ウインドウ空白

歩きながら喋らない

無言時は文字を一切表示しない

介入（クリック／なでる／おやつ）時：

即座に歩行停止

会話パートに遷移

● UI

UI共通ルール確立：

open == True のUIのみ
handle_event → relayout → draw

設定（⚙）メニュー：

2列＋ページング

ボタン増えても画面外に出ない

会話ウインドウ：

行動ボタンより前面

タイトル領域には侵入しない（描画順＋位置制限）

● おやつ（SNACK）

複数種類対応（JSON駆動）

アイコン付き一覧表示

種類ごとに会話分岐

HUDで状態確認可能

● 衣装（着せ替え）

assets/sprite/clothes/*.png 自動検出

サムネ一覧から選択

保存／復帰対応

● 常駐アプリ機能

最前面化（Always on Top）トグル

設定から即時切替＋次回起動反映

枠なし移動（Ctrl+ドラッグ）

操作不能回避導線あり

● デバッグHUD（F1）

行動状態

移動状態

会話状態

UI open 状態

トラブル原因の即視認が可能

■ 今回特に重要だった設計判断

会話中フラグで移動を止める設計は破綻しやすい
→ 会話は「表示時間で必ず終わる」設計に変更

_stop_walking() と _start_walking() を分離

line_until が未来に残ると移動が永久ロックされるため、
無言化時に必ずリセット

描画パッチで render.py を差し替える際、
x_offset 反映が消えやすい点に注意

■ 次に安全にやれる拡張候補

行動の種類追加（歩く以外：考える／伸びる等）

歩行中の細かい癖（途中停止、振り返り）

おやつ×機嫌の深化（食べ過ぎ／好物）

衣装ごとのオフセットJSON化

■ 一言要約

「相棒として“そこに居る”挙動が完成した安定点。」
これ以降は機能追加というより、性格と演出を足すフェーズ。